---
import { Icon } from 'astro-icon/components'
import Layout from '@/layouts/layout.astro'
import Header from '@/components/generic/header.astro'
import Card from '@/components/generic/card.astro'
import type { MysticSkill } from '@/types/mystic-skill'

export const meta = {
  icon: 'fa6-solid:scroll',
  title: 'Mystic Skills',
  description: 'Mystic Skills compendium.',
  type: 'compendium',
  linkText: 'Mystic Skills',
  createdDate: '2026-02-10',
  updatedDate: '2026-02-10',
  draft: false,
}

const CATEGORY_ORDER = [
  'Puzzle',
  'Area Debuff',
  'Area DMG',
  'Single-target Control',
  'Single-target Burst',
  'Support',
  'Entertainment',
  'General',
  'Movement',
]

// Import all YAML files
const skillFiles = import.meta.glob('@/wwm-data/mystic-skills/*.yaml', { eager: true })

const skills = Object.entries(skillFiles).map(([path, data]) => {
  const slug = path.split('/').pop()?.replace('.yaml', '') ?? 'unknown'
  return { ...(data as MysticSkill), slug }
})

const groupedSkills: Record<string, MysticSkill[]> = {}

for (const category of CATEGORY_ORDER) {
  const categorySkills = skills.filter(skill => skill.category === category)
  if (categorySkills.length > 0) {
    groupedSkills[category] = categorySkills
  }
}

// Handle any skills with categories not in the predefined list
const otherSkills = skills.filter(skill => !CATEGORY_ORDER.includes(skill.category))
if (otherSkills.length > 0) {
  groupedSkills['Other'] = otherSkills
}
---

<Layout>
  <Header title="Mystic Skills" description="A list of known mystic skills." />

  {
    Object.entries(groupedSkills).map(([category, categorySkills]) => (
      <section id={category.toLowerCase().replaceAll(/\s+/g, '-')}>
        <div class="category-header">
          <h2>{category}</h2>
          <span>
            {categorySkills.length} {categorySkills.length === 1 ? 'skill' : 'skills'}
          </span>
        </div>

        <div class="skills-grid">
          {categorySkills.map(skill => (
            <a href={`/compendium/mystic-skills/${skill.slug}`} class="skill-card-link">
              <Card hover>
                <div class="card-header">
                  <h3>{skill.name}</h3>
                  <div class="card-meta">
                    {skill.tags?.map((tag: string) => (
                      <span class="card-tag">{tag}</span>
                    ))}
                  </div>
                </div>
                <p class="card-description">{skill.description}</p>
                <div class="card-footer">
                  <span class="card-link">
                    View Details
                    <Icon name="fa6-solid:arrow-right" class="link-icon" />
                  </span>
                </div>
              </Card>
            </a>
          ))}
        </div>
      </section>
    ))
  }
</Layout>

<style lang="scss">
  @use '@/scss/mixins' as *;

  section {
    margin-bottom: 5rem;

    &:last-child {
      margin-bottom: 0;
    }
  }

  .category-header {
    display: flex;
    align-items: baseline;
    gap: 1.5rem;
    margin-bottom: 2rem;
    @include border($bottom: true);
    padding-bottom: 1rem;

    h2 {
      @include text-color(default);
      @include font-size(2xl);
    }

    span {
      @include font-size(sm);
      @include text-color(primary);
      text-transform: uppercase;
      @include increase-letter-spacing(0.5);
      @include font-sans-bold;
    }
  }

  .skills-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 1.5rem;
  }

  .skill-card-link {
    text-decoration: none;
    color: inherit;
    display: flex;

    &:hover {
      .card-link {
        @include text-color(primary);
        transform: translateX(0.325rem);
      }
    }
  }

  .card-header {
    display: flex;
    flex-direction: column;
    margin-bottom: 1.5rem;
  }

  .card-meta {
    display: flex;
    gap: 0.5rem;
    @include font-size(sm);
    @include text-color(primary);
  }

  .card-tag:before {
    content: '#';
  }

  .card-description {
    @include font-size(base);
    @include text-color(muted);
    margin-bottom: 1.25rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    flex-grow: 1;
  }

  .card-footer {
    margin-top: auto;
  }

  .card-link {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    @include font-size(sm);
    @include font-sans-bold;
    @include text-color(muted);
    transition:
      transform 0.3s ease,
      color 0.3s ease;
  }

  .link-icon {
    font-size: 1.15em;
  }
</style>
